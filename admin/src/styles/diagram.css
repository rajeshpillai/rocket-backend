@layer components {
  /* Paper view — full-page overlay (Basecamp style) */
  .paper-view {
    @apply fixed inset-0 z-50 flex flex-col bg-stone-50 dark:bg-gray-900;
  }

  .paper-header {
    @apply flex items-center justify-between px-6 py-3 shrink-0
           bg-white border-b border-gray-200 shadow-sm
           dark:bg-gray-800 dark:border-gray-700;
  }

  .paper-header-left {
    @apply flex items-center gap-3;
  }

  .paper-header-right {
    @apply flex items-center gap-2;
  }

  .paper-back-btn {
    @apply flex items-center gap-1.5 text-sm text-gray-500
           hover:text-gray-900 cursor-pointer transition-colors
           px-2 py-1 rounded hover:bg-gray-100
           dark:text-gray-400 dark:hover:text-gray-100 dark:hover:bg-gray-700;
  }

  .paper-title {
    @apply text-base font-semibold text-gray-900 dark:text-gray-100;
  }

  .paper-subtitle {
    @apply text-xs text-gray-400 font-normal ml-2;
  }

  .paper-body {
    @apply flex flex-col flex-1 overflow-hidden;
  }

  /* Metadata panel — collapsible bar below header */
  .metadata-panel {
    @apply shrink-0 overflow-hidden transition-all duration-200
           bg-white border-b border-gray-200
           dark:bg-gray-800 dark:border-gray-700;
  }

  .metadata-panel-inner {
    @apply px-6 py-3 flex flex-wrap gap-x-4 gap-y-2 items-end;
  }

  .metadata-field {
    @apply flex flex-col gap-0.5;
    min-width: 140px;
  }

  .metadata-field-wide {
    @apply flex flex-col gap-0.5;
    min-width: 200px;
  }

  .metadata-label {
    @apply text-xs font-medium text-gray-500 dark:text-gray-400;
  }

  .metadata-input {
    @apply text-sm border border-gray-200 rounded px-2 py-1
           bg-white text-gray-900 outline-none
           focus:border-blue-400 focus:ring-1 focus:ring-blue-100
           dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600;
  }

  .metadata-select {
    @apply text-sm border border-gray-200 rounded px-2 py-1
           bg-white text-gray-900 outline-none cursor-pointer
           focus:border-blue-400 focus:ring-1 focus:ring-blue-100
           dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600;
  }

  .metadata-toggle {
    @apply flex items-center gap-2 pb-1;
  }

  /* Toolbar dropdown */
  .toolbar-dropdown {
    @apply relative;
  }

  .toolbar-dropdown-menu {
    @apply absolute right-0 top-full mt-1 bg-white border border-gray-200
           rounded-md shadow-lg py-1 z-20 min-w-36
           dark:bg-gray-800 dark:border-gray-700;
  }

  .toolbar-dropdown-item {
    @apply block w-full text-left px-3 py-1.5 text-sm text-gray-700
           hover:bg-gray-50 cursor-pointer transition-colors
           dark:text-gray-300 dark:hover:bg-gray-700;
  }

  /* Diagram layout */
  .diagram-container {
    @apply flex flex-1 overflow-hidden;
  }

  .diagram-canvas-wrap {
    @apply flex-1 relative overflow-hidden;
    background-color: #f8f8f4;
    background-image:
      radial-gradient(circle, #ddd 1px, transparent 1px);
    background-size: 24px 24px;
  }

  .diagram-canvas-wrap svg {
    @apply w-full h-full select-none;
    cursor: grab;
    -webkit-user-select: none;
  }

  .diagram-canvas-wrap svg:active {
    cursor: grabbing;
  }

  .diagram-toolbar {
    @apply absolute top-3 right-3 flex gap-1 z-10;
  }

  .diagram-toolbar button {
    @apply bg-white border border-gray-200 rounded px-2.5 py-1
           text-xs text-gray-600 hover:bg-gray-50 hover:text-gray-900
           shadow-sm transition-colors cursor-pointer
           dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300
           dark:hover:bg-gray-700 dark:hover:text-gray-100;
  }

  /* Property panel (editable) */
  .diagram-property-panel {
    @apply w-80 border-l overflow-y-auto p-4
           flex flex-col gap-3 shrink-0
           bg-white border-gray-200
           dark:bg-gray-800 dark:border-gray-700;
  }

  .diagram-property-header {
    @apply flex items-center justify-between pb-2 border-b border-gray-100
           dark:border-gray-700;
  }

  .diagram-property-title {
    @apply text-sm font-semibold text-gray-900 dark:text-gray-100;
  }

  .diagram-property-close {
    @apply text-gray-400 hover:text-gray-600 cursor-pointer p-1
           rounded hover:bg-gray-100 transition-colors text-xs
           dark:hover:text-gray-300 dark:hover:bg-gray-700;
  }

  .diagram-property-section {
    @apply flex flex-col gap-1;
  }

  .diagram-property-label {
    @apply text-xs font-medium text-gray-500 uppercase tracking-wide
           dark:text-gray-400;
  }

  .diagram-property-value {
    @apply text-sm text-gray-900 bg-gray-50 rounded px-2 py-1.5
           border border-gray-100 font-mono
           dark:text-gray-100 dark:bg-gray-700 dark:border-gray-600;
  }

  .diagram-property-badge {
    @apply text-xs font-medium px-2 py-0.5 rounded-full inline-block;
  }

  /* Action card in editable panel */
  .action-card {
    @apply border border-gray-200 rounded p-2 flex flex-col gap-1.5 bg-gray-50
           dark:border-gray-600 dark:bg-gray-700;
  }

  .action-card-header {
    @apply flex items-center justify-between;
  }

  .action-remove-btn {
    @apply text-xs text-red-400 hover:text-red-600 cursor-pointer;
  }

  /* Transition card in state machine panel */
  .transition-card {
    @apply border border-gray-200 rounded p-2 flex flex-col gap-1.5 bg-gray-50
           dark:border-gray-600 dark:bg-gray-700;
  }

  .transition-card-header {
    @apply flex items-center justify-between text-xs text-gray-500
           dark:text-gray-400;
  }

  /* Delete button */
  .panel-delete-btn {
    @apply mt-2 w-full text-center text-xs text-red-500 border border-red-200
           rounded py-1.5 hover:bg-red-50 hover:text-red-700 cursor-pointer
           transition-colors
           dark:text-red-400 dark:border-red-800 dark:hover:bg-red-900/30;
  }

  /* Add button */
  .panel-add-btn {
    @apply text-xs text-blue-600 hover:text-blue-800 cursor-pointer
           flex items-center gap-1
           dark:text-blue-400 dark:hover:text-blue-300;
  }

  .diagram-empty {
    @apply flex flex-1 items-center justify-center text-gray-400 text-sm
           dark:text-gray-500;
  }

  /* SVG node styles */
  .diagram-node {
    cursor: pointer;
  }

  .diagram-node:hover rect,
  .diagram-node:hover polygon,
  .diagram-node:hover circle {
    filter: brightness(0.95);
  }

  .diagram-edge-label {
    font-size: 11px;
    fill: #6b7280;
    pointer-events: none;
  }

  /* ERD detail panel field list */
  .erd-field-list {
    @apply flex flex-col gap-0;
  }

  .erd-field-row {
    @apply flex items-center justify-between text-xs py-1 px-1
           border-b border-gray-50 last:border-b-0
           dark:border-gray-700;
  }

  .erd-field-name {
    @apply font-medium text-gray-800 dark:text-gray-200;
  }

  .erd-field-type {
    @apply text-gray-400 font-mono text-[10px];
  }

  .erd-field-badges {
    @apply flex gap-1 ml-1;
  }

  .erd-field-badge {
    @apply text-[9px] px-1 py-0 rounded bg-gray-100 text-gray-500
           dark:bg-gray-700 dark:text-gray-400;
  }

  .erd-relation-item {
    @apply text-xs text-gray-600 py-1 border-b border-gray-50 last:border-b-0
           dark:text-gray-400 dark:border-gray-700;
  }
}

/* Dark mode overrides for raw CSS values */
.dark .diagram-canvas-wrap {
  background-color: #1e1e2e;
  background-image: radial-gradient(circle, #444 1px, transparent 1px);
}

.dark .diagram-edge-label {
  fill: #9ca3af;
}

.dark .diagram-node:hover rect,
.dark .diagram-node:hover polygon,
.dark .diagram-node:hover circle {
  filter: brightness(1.1);
}
